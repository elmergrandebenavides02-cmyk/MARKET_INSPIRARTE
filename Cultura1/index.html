<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market ADN Tigo - Bienestar</title>
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --tigo-blue: #0033a0;
            --tigo-yellow: #ffcd00;
            --tigo-red: #e30613;
            --tigo-orange: #f39200;
            --tigo-green: #78be20;
            --tigo-purple: #6f2da8;
            --tigo-light-blue: #00a3e0;
            --whatsapp-green: #25D366;
        }

        body { font-family: 'Arial', sans-serif; margin: 0; background-color: #f4f4f4; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 500px; background: white; min-height: 100vh; box-shadow: 0 0 10px rgba(0,0,0,0.1); position: relative; }
        
        header { background: var(--tigo-blue); color: white; text-align: center; padding: 20px; border-bottom: 5px solid var(--tigo-yellow); position: relative; }
        
        .info-icon { position: absolute; right: 15px; top: 15px; background: white; color: var(--tigo-blue); border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-weight: bold; cursor: pointer; border: 2px solid var(--tigo-yellow); font-size: 18px; }

        .grid-container { padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        
        .card-menu { 
            background: white; border-radius: 15px; padding: 15px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); cursor: pointer;
            transition: transform 0.2s; border: 1px solid #ddd;
        }
        .completado-hoy { border: 2px solid var(--tigo-yellow); background: #fffdf0; }

        .btn-capacidad { 
            width: 100%; border: none; border-radius: 10px; color: white; 
            padding: 12px; font-weight: bold; font-size: 16px; margin-bottom: 10px;
        }

        .progress-container { background: #eee; border-radius: 10px; height: 12px; overflow: hidden; margin: 10px 0; }
        .progress-bar { height: 100%; width: 0%; transition: width 0.8s ease-out; }

        .stats { font-size: 14px; color: #666; display: flex; justify-content: space-between; align-items: center; }
        .nivel-texto { font-size: 11px; color: var(--tigo-blue); font-weight: bold; text-transform: uppercase; margin-top: 5px; display: block; }
        .badge { color: #28a745; font-weight: bold; font-size: 12px; display: none; }

        #pantalla-login, #pantalla-reto, #pantalla-instrucciones { display: none; flex-direction: column; align-items: center; padding: 30px; text-align: center; }
        
        input { padding: 12px; width: 80%; margin: 10px 0; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; }
        .btn-main { background: var(--tigo-blue); color: white; border: none; padding: 15px 30px; border-radius: 30px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; }
        .btn-secundario { background: #eee; color: #333; border: none; padding: 12px 20px; border-radius: 30px; font-size: 14px; cursor: pointer; margin-top: 10px; width: 90%; font-weight: bold; }
        
        .display-box { background: #fff; border-radius: 20px; padding: 20px; margin: 20px 0; border: 1px solid #eee; width: 100%; box-sizing: border-box; }
        .accion-box { background: #fff3cd; padding: 15px; border-left: 5px solid var(--tigo-yellow); margin-top: 20px; text-align: left; }

        /* Estilos del Modal Personalizado (Para eliminar el mensaje del navegador) */
        #custom-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; justify-content: center; align-items: center; }
        .modal-content { background: white; width: 85%; max-width: 400px; border-radius: 20px; padding: 30px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.3); animation: fadeIn 0.3s ease; }
        
        #pantalla-instrucciones { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 100; box-sizing: border-box; display: none; }
        .instruccion-item { text-align: left; margin-bottom: 20px; font-size: 16px; line-height: 1.4; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <div id="custom-modal">
        <div class="modal-content">
            <h3 id="modal-titulo" style="color: var(--tigo-blue); margin-top: 0;">MARKET ADN</h3>
            <p id="modal-mensaje" style="color: #444; line-height: 1.6; font-size: 16px;"></p>
            <button class="btn-main" onclick="cerrarModalPersonalizado()">ACEPTAR</button>
        </div>
    </div>

    <div id="pantalla-login">
        <h1 style="color:var(--tigo-blue)">üöÄ ADN TIG0 MARKET</h1>
        <p>Diciendo y Haciendo</p>
        <input type="password" id="input-password" placeholder="Contrase√±a">
        <button class="btn-main" onclick="verificarAcceso()">ENTRAR</button>
    </div>

    <div id="pantalla-instrucciones">
        <h2 style="color:var(--tigo-blue)">Tu Camino al √âxito</h2>
        <div class="instruccion-item"><strong>üõí Pasillos de Cultura:</strong> Elige una capacidad. Cada reto sumado te har√° subir de nivel.</div>
        <div class="instruccion-item"><strong>üéñÔ∏è Niveles ADN:</strong> Pasa de Novato a <strong>Embajador de Cultura</strong> logrando retos diarios.</div>
        <div class="instruccion-item"><strong>‚öì El Ancla:</strong> Tu <strong>llavero</strong> es la se√±al. M√≠ralo y recuerda: Diciendo y Haciendo.</div>
        <button class="btn-main" onclick="cerrarInstrucciones()">¬°EMPEZAR EL CAMINO!</button>
    </div>

    <div id="app-content" style="display:none;">
        <header>
            <div class="info-icon" onclick="mostrarInstrucciones()">!</div>
            <h1 style="margin:0; font-size: 24px;">MARKET DE CULTURA</h1>
            <p style="margin:5px 0 0 0;">Diciendo y Haciendo</p>
        </header>

        <div id="menu-principal" class="grid-container">
            <div class="card-menu" id="card-agilidad" onclick="irAPasillo('agilidad')">
                <button class="btn-capacidad" style="background:var(--tigo-light-blue)">AGILIDAD</button>
                <div class="progress-container"><div id="bar-agilidad" class="progress-bar" style="background:var(--tigo-light-blue)"></div></div>
                <div class="stats">
                    <div><strong id="pts-agilidad">0</strong> retos <br> <span id="nivel-agilidad" class="nivel-texto">Novato ADN</span></div>
                    <span id="badge-agilidad" class="badge">‚úî HECHO HOY</span>
                </div>
            </div>

            <div class="card-menu" id="card-foco" onclick="irAPasillo('foco')">
                <button class="btn-capacidad" style="background:var(--tigo-orange)">FOCO</button>
                <div class="progress-container"><div id="bar-foco" class="progress-bar" style="background:var(--tigo-orange)"></div></div>
                <div class="stats">
                    <div><strong id="pts-foco">0</strong> retos <br> <span id="nivel-foco" class="nivel-texto">Novato ADN</span></div>
                    <span id="badge-foco" class="badge">‚úî HECHO HOY</span>
                </div>
            </div>

            <div class="card-menu" id="card-colaboracion" onclick="irAPasillo('colaboracion')">
                <button class="btn-capacidad" style="background:var(--tigo-green)">COLABORACI√ìN</button>
                <div class="progress-container"><div id="bar-colaboracion" class="progress-bar" style="background:var(--tigo-green)"></div></div>
                <div class="stats">
                    <div><strong id="pts-colaboracion">0</strong> retos <br> <span id="nivel-colaboracion" class="nivel-texto">Novato ADN</span></div>
                    <span id="badge-colaboracion" class="badge">‚úî HECHO HOY</span>
                </div>
            </div>

            <div class="card-menu" id="card-integridad" onclick="irAPasillo('integridad')">
                <button class="btn-capacidad" style="background:var(--tigo-purple)">INTEGRIDAD</button>
                <div class="progress-container"><div id="bar-integridad" class="progress-bar" style="background:var(--tigo-purple)"></div></div>
                <div class="stats">
                    <div><strong id="pts-integridad">0</strong> retos <br> <span id="nivel-integridad" class="nivel-texto">Novato ADN</span></div>
                    <span id="badge-integridad" class="badge">‚úî HECHO HOY</span>
                </div>
            </div>

            <div class="card-menu" id="card-talento" onclick="irAPasillo('talento')">
                <button class="btn-capacidad" style="background:var(--tigo-red)">TALENTO</button>
                <div class="progress-container"><div id="bar-talento" class="progress-bar" style="background:var(--tigo-red)"></div></div>
                <div class="stats">
                    <div><strong id="pts-talento">0</strong> retos <br> <span id="nivel-talento" class="nivel-texto">Novato ADN</span></div>
                    <span id="badge-talento" class="badge">‚úî HECHO HOY</span>
                </div>
            </div>
        </div>

        <div id="pantalla-reto">
            <h2 id="titulo-pasillo" style="color: var(--tigo-blue); margin-top: 0;">CATEGOR√çA</h2>
            <div class="display-box">
                <p id="frase-display" style="font-size: 18px; font-weight: bold; color: #333;"></p>
                <div class="accion-box">
                    <strong style="color: #856404;">‚ö° ACCI√ìN A EJECUTAR:</strong>
                    <p id="reto-display" style="margin: 10px 0 0 0; color: #333;"></p>
                </div>
            </div>
            
            <button id="btn-aceptar" class="btn-main" onclick="completarReto()">¬°LO HAR√â HOY!</button>
            <button id="btn-otro" class="btn-secundario" onclick="cambiarReto()">üîÑ Ver otra opci√≥n</button>
            <button id="btn-compartir" class="btn-secundario" style="background:var(--whatsapp-green); color:white;" onclick="compartirWhatsApp()">
                üü¢ Compartir FRASE / ACCI√ìN
            </button>

            <p id="msg-bloqueo" style="color: #666; font-weight: bold; display:none; margin-top:20px;">¬°Reto aceptado! Vuelve ma√±ana por uno nuevo.</p>
            <button onclick="mostrarMenu()" style="margin-top: 20px; border: none; background: none; color: var(--tigo-blue); text-decoration: underline; cursor: pointer;">Volver al mercado</button>
        </div>
    </div>
</div>

<script src="capacidad.js"></script>

<script>
    const CLAVE_CORRECTA = "tigo2026";
    let capActual = '';

    // --- MANEJO DEL MODAL PERSONALIZADO ---
    function mostrarModalPropio(titulo, mensaje) {
        document.getElementById('modal-titulo').innerText = titulo;
        document.getElementById('modal-mensaje').innerHTML = mensaje;
        document.getElementById('custom-modal').style.display = 'flex';
    }

    function cerrarModalPersonalizado() {
        document.getElementById('custom-modal').style.display = 'none';
        mostrarMenu();
    }

    // --- L√ìGICA DE ACCESO ---
    function checkAcceso() {
        if (localStorage.getItem('tigo_logged') === 'true') {
            document.getElementById('pantalla-login').style.display = 'none';
            document.getElementById('app-content').style.display = 'block';
            if (!localStorage.getItem('instrucciones_vistas')) {
                mostrarInstrucciones();
            }
            actualizarInterfaz();
        } else {
            document.getElementById('pantalla-login').style.display = 'flex';
        }
    }

    function verificarAcceso() {
        const input = document.getElementById('input-password').value.toLowerCase();
        if (input === CLAVE_CORRECTA) {
            localStorage.setItem('tigo_logged', 'true');
            checkAcceso();
        } else {
            mostrarModalPropio("ACCESO", "Clave incorrecta. Int√©ntalo de nuevo.");
        }
    }

    function mostrarInstrucciones() {
        document.getElementById('pantalla-instrucciones').style.display = 'flex';
    }

    function cerrarInstrucciones() {
        localStorage.setItem('instrucciones_vistas', 'true');
        document.getElementById('pantalla-instrucciones').style.display = 'none';
    }

    // --- L√ìGICA DE RETOS ---
    function irAPasillo(id) {
        if (typeof capacidadDB === 'undefined') {
            mostrarModalPropio("ERROR", "No se encontr√≥ el archivo de retos.");
            return;
        }
        capActual = id;
        cambiarReto(); 
        document.getElementById('menu-principal').style.display = 'none';
        document.getElementById('pantalla-reto').style.display = 'flex';
    }

    function cambiarReto() {
        const hoy = new Date().toDateString();
        let p = JSON.parse(localStorage.getItem('pTigo')) || {ultimosRetos: {}};
        
        const lista = capacidadDB[capActual];
        const randomItem = lista[Math.floor(Math.random() * lista.length)];

        document.getElementById('titulo-pasillo').innerText = capActual.toUpperCase();
        document.getElementById('frase-display').innerText = `"${randomItem.frase}"`;
        document.getElementById('reto-display').innerText = randomItem.reto;

        const yaHizoReto = p.ultimosRetos && p.ultimosRetos[capActual] === hoy;
        
        document.getElementById('btn-aceptar').style.display = yaHizoReto ? 'none' : 'block';
        document.getElementById('btn-otro').style.display = yaHizoReto ? 'none' : 'block';
        document.getElementById('btn-compartir').style.display = yaHizoReto ? 'none' : 'block';
        document.getElementById('msg-bloqueo').style.display = yaHizoReto ? 'block' : 'none';
    }

    function compartirWhatsApp() {
        const frase = document.getElementById('frase-display').innerText;
        const reto = document.getElementById('reto-display').innerText;
        const categoria = capActual.toUpperCase();

        const textoMensaje = `‚ú® *MARKET DE CULTURA - ADN TIGO* ‚ú®%0A%0A` +
            `Categor√≠a: *${categoria}*%0A%0A` +
            `üìñ _${frase}_%0A%0A` +
            `‚ö° *ACCI√ìN DEL D√çA:*%0A${reto}%0A%0A` +
            `#DiciendoYHaciendo üöÄ`;

        window.open(`https://wa.me/?text=${textoMensaje}`, '_blank');
    }

    function completarReto() {
        const hoy = new Date().toDateString();
        let p = JSON.parse(localStorage.getItem('pTigo')) || {
            agilidad:0, foco:0, colaboracion:0, integridad:0, talento:0, ultimosRetos: {}
        };

        p[capActual] = (p[capActual] || 0) + 1;
        p.ultimosRetos = p.ultimosRetos || {};
        p.ultimosRetos[capActual] = hoy;

        localStorage.setItem('pTigo', JSON.stringify(p));

        if (window.confetti) {
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#0033a0', '#ffcd00'] });
        }

        setTimeout(() => {
            const msg = "üöÄ ¬°RETO ACTIVADO!<br><br>Recuerda cumplir esta acci√≥n durante el d√≠a.<br><br>Ten tu ancla <b>'LLAAVERO'</b> a la vista para que te lo recuerde. <br><br>¬°Diciendo y Haciendo!";
            mostrarModalPropio("MARKET ADN", msg);
        }, 500);
    }

    function mostrarMenu() {
        document.getElementById('menu-principal').style.display = 'flex';
        document.getElementById('pantalla-reto').style.display = 'none';
        actualizarInterfaz();
    }

    function calcularNivel(puntos) {
        if (puntos >= 26) return "Embajador de Cultura Tigo üöÄ";
        if (puntos >= 16) return "Maestro Diciendo y Haciendo";
        if (puntos >= 6) return "Practicante ADN";
        return "Novato ADN";
    }

    function actualizarInterfaz() {
        const hoy = new Date().toDateString();
        let p = JSON.parse(localStorage.getItem('pTigo')) || {
            agilidad:0, foco:0, colaboracion:0, integridad:0, talento:0, ultimosRetos: {}
        };
        
        ["agilidad", "foco", "colaboracion", "integridad", "talento"].forEach(id => {
            const puntos = p[id] || 0;
            const perc = Math.min((puntos / 30) * 100, 100);
            
            if(document.getElementById(`bar-${id}`)) document.getElementById(`bar-${id}`).style.width = perc + '%';
            if(document.getElementById(`pts-${id}`)) document.getElementById(`pts-${id}`).innerText = puntos;
            if(document.getElementById(`nivel-${id}`)) document.getElementById(`nivel-${id}`).innerText = calcularNivel(puntos);

            const yaHizoReto = p.ultimosRetos && p.ultimosRetos[id] === hoy;
            const card = document.getElementById(`card-${id}`);
            if(card) {
                card.classList.toggle('completado-hoy', yaHizoReto);
                document.getElementById(`badge-${id}`).style.display = yaHizoReto ? 'block' : 'none';
            }
        });
    }

    window.onload = checkAcceso;
</script>

</body>
</html>
