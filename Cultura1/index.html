<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADN TIGO - El Market</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script src="capacidad.js"></script>

    <style>
        :root {
            --tigo-blue: #00377d;
            --tigo-light-blue: #00a1e1;
            --tigo-gold: #f3b01a;
            --whatsapp: #25D366;
            --blanco: #ffffff;
            --ayuda-bg: #f8f9fa;
        }

        body { 
            font-family: 'Montserrat', sans-serif; 
            background-color: #d1d9e0; 
            margin: 0; 
            padding: 0;
            display: flex; 
            justify-content: center; 
            min-height: 100vh; 
            overflow-x: hidden; 
        }

        .container { 
            width: 100%; 
            max-width: 450px; 
            background: var(--blanco); 
            box-shadow: 0 0 50px rgba(0,0,0,0.2); 
            display: flex; 
            flex-direction: column; 
            position: relative; 
            min-height: 100vh; 
        }

        /* PANTALLA DE ACCESO (PASSWORD) */
        #pantalla-login { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: var(--tigo-blue); 
            z-index: 5000; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            padding: 40px; 
            box-sizing: border-box; 
            text-align: center; 
            color: white;
        }

        .input-password { 
            padding: 15px; 
            width: 80%; 
            border-radius: 12px; 
            border: none; 
            margin: 25px 0; 
            font-size: 1.4rem; 
            text-align: center; 
            font-weight: bold;
            letter-spacing: 8px;
            color: var(--tigo-blue);
            outline: none;
        }

        header { 
            background: linear-gradient(135deg, var(--tigo-blue), var(--tigo-light-blue)); 
            color: white; 
            text-align: center; 
            padding: 25px 20px; 
            border-bottom: 6px solid var(--tigo-gold); 
            position: relative; 
        }

        .btn-info-guia {
            position: absolute; 
            right: 15px; 
            top: 20px; 
            width: 32px; 
            height: 32px;
            background: rgba(255, 255, 255, 0.2); 
            border: 2px solid white; 
            border-radius: 50%;
            color: white; 
            font-weight: bold; 
            cursor: pointer; 
            display: flex;
            align-items: center; 
            justify-content: center; 
            font-size: 1.2rem;
            transition: all 0.3s;
            z-index: 10;
        }

        /* Pantalla Bienvenida */
        #pantalla-bienvenida { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: var(--blanco); 
            z-index: 2000; 
            padding: 30px; 
            box-sizing: border-box; 
            display: none; 
            flex-direction: column; 
            overflow-y: auto; 
        }

        .instrucciones-item { 
            margin-bottom: 15px; 
            font-size: 0.9rem; 
            line-height: 1.5; 
            color: #333;
        }

        #menu-principal, #pantalla-reto { 
            padding: 25px; 
            box-sizing: border-box; 
        }

        /* Estilos Tarjeta H√°bito */
        .seccion-habito { 
            background: #fff9eb; 
            border: 2px dashed var(--tigo-gold); 
            border-radius: 20px; 
            padding: 20px; 
            margin-bottom: 25px; 
            text-align: center; 
        }

        .input-hora { 
            padding: 12px; 
            border-radius: 10px; 
            border: 1px solid var(--tigo-gold); 
            font-family: 'Montserrat'; 
            font-weight: bold; 
            color: var(--tigo-blue); 
            outline: none; 
        }

        .grid-pasillos { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 15px; 
        }

        .card-menu { 
            background: white; 
            border-radius: 15px; 
            padding: 15px; 
            border: 1px solid #eee; 
            text-align: center; 
            cursor: pointer; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
            position: relative; 
            transition: transform 0.2s, box-shadow 0.2s; 
        }

        .card-menu:active { transform: scale(0.95); }

        .card-menu.bloqueado { 
            opacity: 0.6; 
            cursor: not-allowed; 
            background: #f9f9f9; 
        }

        .lock-icon { 
            display: none; 
            font-size: 1.5rem; 
            margin-top: 10px; 
        }

        .card-menu.bloqueado .lock-icon { display: block; }

        .btn-categoria { 
            width: 100%; 
            padding: 8px; 
            border: none; 
            border-radius: 8px; 
            color: white; 
            font-weight: bold; 
            margin-bottom: 8px; 
            font-size: 0.7rem; 
            text-transform: uppercase; 
        }

        .color-agilidad { background-color: #00a1e1; }
        .color-colaboracion { background-color: #00377d; }
        .color-foco { background-color: #f3b01a; color: #00377d !important; }
        .color-integridad { background-color: #722f37; }
        .color-talento { background-color: #6a1b9a; }

        .mini-bar-container { 
            width: 100%; 
            background: #eee; 
            height: 8px; 
            border-radius: 10px; 
            overflow: hidden; 
            margin: 10px 0; 
        }

        .mini-bar-fill { 
            height: 100%; 
            width: 0%; 
            transition: width 0.5s; 
        }

        .btn-principal { 
            width: 100%; 
            padding: 16px; 
            border-radius: 12px; 
            border: none; 
            color: white; 
            font-size: 1rem; 
            font-weight: 700; 
            cursor: pointer; 
            background: var(--tigo-blue); 
            margin-bottom: 12px; 
            text-transform: uppercase; 
            transition: 0.3s; 
        }

        .btn-whatsapp { 
            width: 100%; 
            padding: 14px; 
            background: var(--whatsapp); 
            color: white; 
            border: none; 
            border-radius: 12px; 
            font-weight: 700; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 10px; 
            margin-bottom: 12px; 
            text-decoration: none; 
            font-size: 0.9rem; 
            box-sizing: border-box; 
        }

        .btn-secundario { 
            width: 100%; 
            padding: 12px; 
            background: #f8f9fa; 
            border: 1px solid #e0e0e0; 
            border-radius: 12px; 
            color: #666; 
            font-weight: 600; 
            cursor: pointer; 
            margin-bottom: 8px; 
            font-size: 0.85rem; 
        }

        .reto-main-card { 
            background: white; 
            border-radius: 25px; 
            padding: 25px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.05); 
            text-align: center; 
            border: 1px solid #f0f0f0; 
        }

        .frase-quote { 
            font-size: 1.1rem; 
            color: var(--tigo-blue); 
            font-weight: bold; 
            margin-bottom: 20px; 
            line-height: 1.4; 
            font-style: italic; 
            min-height: 80px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }

        .custom-modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0, 55, 125, 0.9); 
            z-index: 6000; 
            justify-content: center; 
            align-items: center; 
            padding: 20px; 
        }

        .modal-content { 
            background: white; 
            padding: 30px; 
            border-radius: 25px; 
            text-align: center; 
            max-width: 380px; 
            width: 100%; 
        }

        .btn-ayuda-soporte { 
            width: 100%; 
            padding: 12px; 
            background: var(--ayuda-bg); 
            color: var(--tigo-blue); 
            border: 1px solid #ddd; 
            border-radius: 15px; 
            font-weight: bold; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 8px; 
            margin-top: 20px; 
            text-decoration: none; 
            font-size: 0.8rem; 
        }

        /* Estilo para el Modal de Error Enkanta2 */
        .modal-error-content {
            background: white;
            padding: 30px;
            border-radius: 25px;
            text-align: center;
            max-width: 380px;
            width: 90%;
            border-top: 8px solid #ff4d4d;
        }

        .btn-soporte-wa {
            display: inline-block;
            width: 100%;
            padding: 15px;
            background: var(--whatsapp);
            color: white;
            text-decoration: none;
            border-radius: 12px;
            font-weight: bold;
            margin-top: 20px;
        }
    </style>
</head>
<body>

<div id="pantalla-login">
    <h2 style="margin-bottom: 10px;">MARKET INSPIRARTE</h2>
    <p style="font-size: 0.8rem; opacity: 0.8;">CULTURA ADN TIGO</p>
    <p style="font-size: 0.9rem; margin-top: 20px;">Ingresa el c√≥digo de acceso:</p>
    <input type="password" id="pass-field" class="input-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
    <button onclick="verificarAcceso()" class="btn-principal" style="background: var(--tigo-gold); color: var(--tigo-blue); width: 80%;">ENTRAR</button>
    <p style="font-size: 0.7rem; margin-top: 30px; opacity: 0.7;">Un producto de Enkanta2 "dos manos un encanto"</p>
</div>

<div class="container">
    <div id="pantalla-bienvenida">
        <h2 style="color: var(--tigo-blue); text-align: center; margin-top: 0;">Bienvenidos al Market Inspirarte<br><small style="color: var(--tigo-light-blue);">CULTURA ADN TIGO</small></h2>
        <p style="font-size: 0.9rem; color: #555;">Este no es solo un sitio web; es tu espacio para transformar el ADN TIGO en acciones reales.</p>
        
        <h4 style="color: var(--tigo-blue); margin-bottom: 10px;">¬øC√≥mo funciona tu ruta?</h4>
        <div class="instrucciones-item">üìç <strong>Elige una capacidad:</strong> Explora los pasillos del Market.</div>
        <div class="instrucciones-item">‚ö° <strong>Acepta el Reto:</strong> Lee tu frase y activa tu compromiso diario.</div>
        <div class="instrucciones-item">üöÄ <strong>Sube de Nivel:</strong> La repetici√≥n crea h√°bito:
            <div style="margin-top:10px; background: #f9f9f9; padding: 12px; border-radius: 12px; font-size: 0.85rem; border: 1px solid #eee;">
                üå± Iniciado: 0 - 6 d√≠as<br>
                üåø Avanzado: 7 - 13 d√≠as<br>
                üå≥ Maestro: 14 - 20 d√≠as<br>
                üëë Leyenda: +21 d√≠as
            </div>
        </div>

        <button onclick="cerrarBienvenida()" class="btn-principal" style="margin-top: 25px; background: var(--tigo-gold); color: var(--tigo-blue);">¬°ENTENDIDO, VAMOS!</button>
    </div>

    <header>
        <button class="btn-info-guia" onclick="mostrarBienvenida()">i</button>
        <h1 style="margin:0; font-size: 1.4rem;">EL MARKET</h1>
        <p style="margin:5px 0 0; font-size: 0.85rem; opacity: 0.9;">Enkanta2 "dos manos un encanto"</p>
    </header>

    <div id="menu-principal">
        <div class="seccion-habito">
            <div style="font-size: 1.5rem; margin-bottom: 5px;">üîî</div>
            <strong style="color: var(--tigo-blue); font-size: 0.9rem; display: block;">PROGRAMA TU RECORDATORIO</strong>
            <p style="font-size: 0.75rem; color: #666; margin: 5px 0 15px;">Crea el h√°bito. Elige una hora para recibir una alerta diaria:</p>
            <div style="display: flex; gap: 10px; justify-content: center; align-items: center; flex-wrap: wrap;">
                <input type="time" id="hora-alerta" class="input-hora" value="08:00">
                <button onclick="crearAlertaCalendario()" class="btn-principal" style="margin-bottom: 0; padding: 10px 15px; font-size: 0.75rem; width: auto; background: var(--tigo-gold); color: var(--tigo-blue);">
                    ACTIVAR ALERTA
                </button>
            </div>
        </div>

        <h3 style="color: var(--tigo-blue); margin-top: 0; font-size: 1rem;">Selecciona una Capacidad:</h3>
        <div class="grid-pasillos" id="grid-pasillos"></div>
        
        <a href="https://wa.me/573244173977?text=Hola%20equipo%20Enkanta2" target="_blank" class="btn-ayuda-soporte">üÜò NECESITO AYUDA</a>
    </div>

    <div id="pantalla-reto" style="display:none;">
        <h2 id="titulo-pasillo" style="text-align: center; color: var(--tigo-blue); text-transform: uppercase; margin-bottom: 5px;"></h2>
        <div id="status-evolucion" style="text-align: center; font-size: 0.8rem; font-weight: bold; color: #666;"></div>
        <div class="mini-bar-container" style="width: 80%; margin: 10px auto 20px;"><div id="bar-progreso-detalle" class="mini-bar-fill"></div></div>
        
        <div class="reto-main-card">
            <div id="frase-display" class="frase-quote"></div>
            <div style="background: #fdfdfd; padding: 20px; border-radius: 15px; border-left: 6px solid var(--tigo-gold); margin-bottom: 20px; text-align: left;">
                <strong style="color: var(--tigo-blue); font-size: 0.8rem; display: block; margin-bottom: 8px;">‚ö° MISI√ìN SUGERIDA:</strong>
                <div id="reto-display" style="font-size: 0.95rem; line-height: 1.4; color: #333; font-weight: 500;"></div>
            </div>

            <button onclick="confirmarMision()" class="btn-principal">¬°ACEPTO EL RETO!</button>
            
            <a id="btn-share-wa" href="#" target="_blank" class="btn-whatsapp">
                <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" width="18" height="18"> COMPARTIR RETO
            </a>
            
            <button onclick="generarReto()" class="btn-secundario">üîÑ VER OTRO RETO</button>
            <button onclick="volverMenu()" class="btn-secundario" style="border: none; background: transparent; color: #999;">‚Üê VOLVER AL MARKET</button>
        </div>
    </div>
</div>

<div id="modal-confirmacion" class="custom-modal">
    <div id="modal-box" class="modal-content">
        <span id="emoji-exito" style="font-size: 4rem; display: block; margin-bottom: 15px;">üöÄ</span>
        <h2 id="titulo-modal" style="color: var(--tigo-blue); margin-top: 0;">¬°RETO ACTIVADO!</h2>
        <p id="texto-modal" style="color: #555; line-height: 1.6; margin-bottom: 25px;">Has aceptado el reto para hoy.<br><strong>¬°Diciendo y Haciendo!</strong></p>
        <button onclick="cerrarYVolver()" class="btn-principal" style="margin-bottom: 0;">¬°ENTENDIDO!</button>
    </div>
</div>

<div id="modal-error-acceso" class="custom-modal">
    <div class="modal-error-content">
        <span style="font-size: 4rem; display: block; margin-bottom: 15px;">‚ö†Ô∏è</span>
        <h2 style="color: var(--tigo-blue); margin: 0 0 10px 0;">ACCESO EXPIRADO</h2>
        <p id="mensaje-error-texto" style="font-size: 0.9rem; color: #555; line-height: 1.5;"></p>
        <a href="https://wa.me/573244173977?text=Hola%20Enkanta2,%20mi%20llave%20de%20acceso%20ha%20expirado" 
           target="_blank" class="btn-soporte-wa">
            CONTACTAR SOPORTE ENKANTA2
        </a>
        <button onclick="location.reload()" class="btn-secundario" style="margin-top: 15px; border: none; background: transparent;">Reintentar</button>
    </div>
</div>

<script>
    // ==========================================
    // CONFIGURACI√ìN DE LLAVEROS - ENKANTA2
    // ==========================================
    const LLAVES_DEMO = ["MarketDemo72", "TigoTemporal", "MarketCulFeb26"];
    const LLAVES_PERMANENTE = ["Enkanta2VIP", "TIGO_FULL_2026", "AdminMarket"];
    const DURACION_DEMO_HORAS = 0.016; // 1 MINUTO PARA TUS PRUEBAS (C√°mbialo a 72 despu√©s)

    function mostrarErrorAcceso(msj) {
        document.getElementById('mensaje-error-texto').innerText = msj;
        document.getElementById('modal-error-acceso').style.display = 'flex';
    }

    function verificarAcceso() {
        const input = document.getElementById('pass-field').value.trim();
        const ahora = new Date().getTime();

        let blacklist = JSON.parse(localStorage.getItem('market_blacklist') || "[]");
        if (blacklist.includes(input)) {
            mostrarErrorAcceso("Esta llave de acceso ya fue utilizada y expir√≥. Ponte en contacto con Enkanta2.");
            return;
        }

        if (LLAVES_PERMANENTE.includes(input)) {
            localStorage.setItem('market_sesion_activa', 'true');
            localStorage.setItem('market_expiracion', 'nunca');
            localStorage.setItem('market_key_usada', input);
            entrarAlMarket();
        } 
        else if (LLAVES_DEMO.includes(input)) {
            const fechaExpiracion = ahora + (DURACION_DEMO_HORAS * 60 * 60 * 1000);
            localStorage.setItem('market_sesion_activa', 'true');
            localStorage.setItem('market_key_usada', input);
            localStorage.setItem('market_expiracion', fechaExpiracion);
            entrarAlMarket();
        } 
        else {
            alert("Llave no v√°lida. Verifica con el administrador.");
        }
    }

    function validarSesion() {
        const activa = localStorage.getItem('market_sesion_activa');
        const expiracion = localStorage.getItem('market_expiracion');
        const llaveUsada = localStorage.getItem('market_key_usada');
        
        if (!activa || !expiracion) return false;
        if (expiracion === 'nunca') return true;

        const ahora = new Date().getTime();
        if (ahora > parseInt(expiracion)) {
            if (llaveUsada) {
                let blacklist = JSON.parse(localStorage.getItem('market_blacklist') || "[]");
                if (!blacklist.includes(llaveUsada)) {
                    blacklist.push(llaveUsada);
                    localStorage.setItem('market_blacklist', JSON.stringify(blacklist));
                }
            }
            localStorage.removeItem('market_sesion_activa');
            localStorage.removeItem('market_expiracion');
            mostrarErrorAcceso("Tu llave de acceso temporal ha expirado. Contacta a Enkanta2 para renovarla.");
            return false;
        }
        return true;
    }

    function entrarAlMarket() {
        document.getElementById('pantalla-login').style.display = 'none';
        renderizarMenu();
        checkBienvenida();
    }

    // ==========================================
    // L√ìGICA DE NEGOCIO ORIGINAL
    // ==========================================
    const capacidad = capacidadDB; 
    const configUI = {
        agilidad: { nombre: "Agilidad", color: "color-agilidad" },
        colaboracion: { nombre: "Colaboraci√≥n", color: "color-colaboracion" },
        foco: { nombre: "Foco", color: "color-foco" },
        integridad: { nombre: "Integridad", color: "color-integridad" },
        talento: { nombre: "Talento", color: "color-talento" }
    };

    let capActual = '';
    let datos = JSON.parse(localStorage.getItem('market_data')) || { progreso: {}, bloqueos: {}, ultima_bienvenida: "" };

    function checkBienvenida() {
        const hoy = new Date().toDateString();
        if (datos.ultima_bienvenida !== hoy) mostrarBienvenida();
    }

    function mostrarBienvenida() { document.getElementById('pantalla-bienvenida').style.display = 'flex'; }
    function cerrarBienvenida() {
        datos.ultima_bienvenida = new Date().toDateString();
        localStorage.setItem('market_data', JSON.stringify(datos));
        document.getElementById('pantalla-bienvenida').style.display = 'none';
    }

    function obtenerNivel(puntos) {
        if (puntos >= 21) return { texto: "Leyenda üëë", pts: puntos };
        if (puntos >= 14) return { texto: "Maestro üå≥", pts: puntos };
        if (puntos >= 7) return { texto: "Avanzado üåø", pts: puntos };
        return { texto: "Iniciado üå±", pts: puntos };
    }

    function renderizarMenu() {
        const grid = document.getElementById('grid-pasillos');
        if(!grid) return;
        grid.innerHTML = '';
        const hoy = new Date().toDateString();

        for (let key in capacidad) {
            const estaBloqueado = datos.bloqueos[key] === hoy;
            const nivel = obtenerNivel(datos.progreso[key] || 0);
            const ui = configUI[key];
            
            const card = document.createElement('div');
            card.className = `card-menu ${estaBloqueado ? 'bloqueado' : ''}`;
            if (!estaBloqueado) card.onclick = () => irAPasillo(key);

            card.innerHTML = `
                <div class="btn-categoria ${ui.color}">${ui.nombre}</div>
                <div class="mini-bar-container"><div class="mini-bar-fill ${ui.color}" style="width: ${Math.min((nivel.pts / 21) * 100, 100)}%"></div></div>
                <div style="font-size: 0.65rem; font-weight: bold; color: #666;">${nivel.texto}</div>
                <div class="lock-icon">üîí</div>
            `;
            grid.appendChild(card);
        }
    }

    function irAPasillo(id) {
        capActual = id;
        document.getElementById('menu-principal').style.display = 'none';
        document.getElementById('pantalla-reto').style.display = 'block';
        document.getElementById('titulo-pasillo').innerText = configUI[id].nombre;
        
        const nivel = obtenerNivel(datos.progreso[id] || 0);
        document.getElementById('status-evolucion').innerText = `Tu Estatus: ${nivel.texto}`;
        const barra = document.getElementById('bar-progreso-detalle');
        barra.className = 'mini-bar-fill ' + configUI[id].color;
        barra.style.width = Math.min((nivel.pts / 21) * 100, 100) + '%';
        generarReto();
    }

    function generarReto() {
        const opciones = capacidad[capActual];
        const actualTxt = document.getElementById('reto-display').innerText;
        let nuevoReto;
        do { nuevoReto = opciones[Math.floor(Math.random() * opciones.length)]; } 
        while (nuevoReto.reto === actualTxt && opciones.length > 1);
        
        document.getElementById('frase-display').innerText = `"${nuevoReto.frase}"`;
        document.getElementById('reto-display').innerText = nuevoReto.reto;
        
        const msj = encodeURIComponent(`üöÄ *RETO ADN TIGO*\n\n"${nuevoReto.frase}"\n\n*Acci√≥n:* ${nuevoReto.reto}`);
        document.getElementById('btn-share-wa').href = `https://wa.me/?text=${msj}`;
    }

    function confirmarMision() {
        const hoy = new Date().toDateString();
        datos.progreso[capActual] = (datos.progreso[capActual] || 0) + 1;
        datos.bloqueos[capActual] = hoy;
        localStorage.setItem('market_data', JSON.stringify(datos));
        
        if(datos.progreso[capActual] >= 21) {
            document.getElementById('emoji-exito').innerText = "üëë";
            confetti({ particleCount: 400, spread: 120 });
        } else {
            document.getElementById('emoji-exito').innerText = "üöÄ";
            confetti({ particleCount: 150, spread: 70 });
        }
        document.getElementById('modal-confirmacion').style.display = 'flex';
    }

    function cerrarYVolver() {
        document.getElementById('modal-confirmacion').style.display = 'none';
        volverMenu();
    }

    function volverMenu() {
        document.getElementById('menu-principal').style.display = 'block';
        document.getElementById('pantalla-reto').style.display = 'none';
        renderizarMenu();
    }

    function crearAlertaCalendario() {
        const hora = document.getElementById('hora-alerta').value;
        const [h, m] = hora.split(':');
        const googleUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=Mi%20Reto%20ADN%20Tigo&recur=RRULE:FREQ=DAILY`;
        window.open(googleUrl, '_blank');
    }

    window.onload = () => {
        if (validarSesion()) entrarAlMarket();
        else document.getElementById('pantalla-login').style.display = 'flex';
    };
</script>
</body>
</html>
