<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market de Cultura - Tigo</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="estilos.css"> <style>
        /* Estilos básicos para asegurar que las barras se vean */
        .progress-container { width: 100%; background: #e0e0e0; border-radius: 10px; margin-top: 5px; height: 10px; overflow: hidden; }
        .progress-bar { height: 100%; width: 0%; transition: width 0.5s ease; background: #0033a0; }
        .completado-hoy { border: 2px solid #ffcd00; opacity: 0.8; }
        #badge-agilidad, #badge-foco, #badge-colaboracion, #badge-integridad, #badge-talento { color: green; font-weight: bold; }
    </style>
</head>
<body>

    <div id="pantalla-login" style="display:none; flex-direction:column; align-items:center; justify-content:center; height:100vh;">
        <h1>MARKET DE CULTURA</h1>
        <p>Diciendo y Haciendo</p>
        <input type="password" id="input-password" placeholder="Contraseña">
        <button onclick="verificarAcceso()">Ingresar</button>
    </div>

    <div id="app-content" style="display:none; flex-direction:column; width:100%;">
        
        <div id="menu-principal" style="width:100%;">
            <header style="background:#0033a0; color:white; padding:20px; text-align:center;">
                <h1>MARKET DE CULTURA</h1>
                <p>Diciendo y Haciendo</p>
            </header>

            <div class="grid-container" style="padding:20px;">
                <div class="card-menu" id="card-talento" onclick="irAPasillo('talento')">
                    <button class="btn-capacidad" style="background:#e30613;">TALENTO</button>
                    <div class="progress-container"><div id="bar-talento" class="progress-bar" style="background:#e30613;"></div></div>
                    <p><span id="pts-talento">0</span> retos logrados</p>
                    <span id="badge-talento" style="display:none;">✔ Completado hoy</span>
                </div>

                <div class="card-menu" id="card-foco" onclick="irAPasillo('foco')">
                    <button class="btn-capacidad" style="background:#f39200;">FOCO</button>
                    <div class="progress-container"><div id="bar-foco" class="progress-bar" style="background:#f39200;"></div></div>
                    <p><span id="pts-foco">0</span> retos logrados</p>
                    <span id="badge-foco" style="display:none;">✔ Completado hoy</span>
                </div>

                </div>
        </div>

        <div id="pantalla-reto" style="display:none; flex-direction:column; align-items:center; padding:20px;">
            <h2 id="titulo-pasillo">CATEGORÍA</h2>
            <div class="display-box">
                <p id="frase-display" style="font-style:italic; font-size:1.2em;"></p>
                <div style="background:#fff3cd; padding:15px; border-left:5px solid #ffcd00; margin:20px 0;">
                    <strong>ACCIÓN A EJECUTAR:</strong>
                    <p id="reto-display"></p>
                </div>
            </div>
            <button id="btn-aceptar" onclick="completarReto()" style="background:#0033a0; color:white; padding:15px 40px; border-radius:25px; border:none; font-size:1.1em; cursor:pointer;">¡LO HARÉ HOY!</button>
            <p id="msg-bloqueo" style="display:none; color:red;">Ya aceptaste un reto de esta categoría hoy. ¡Vuelve mañana!</p>
            <button onclick="mostrarMenu()" style="margin-top:20px; background:none; border:none; text-decoration:underline; cursor:pointer;">Volver</button>
        </div>

    </div>

    <script src="frases.js"></script>

    <script>
        const CLAVE_CORRECTA = "tigo2026";
        let capActual = '';

        function checkAcceso() {
            if (localStorage.getItem('tigo_logged') === 'true') {
                document.getElementById('pantalla-login').style.display = 'none';
                document.getElementById('app-content').style.display = 'flex';
                actualizarInterfaz();
            } else { 
                document.getElementById('pantalla-login').style.display = 'flex'; 
            }
        }

        function verificarAcceso() {
            const pass = document.getElementById('input-password').value.toLowerCase();
            if (pass === CLAVE_CORRECTA) {
                localStorage.setItem('tigo_logged', 'true');
                checkAcceso();
            } else { 
                alert("Clave incorrecta"); 
            }
        }

        function irAPasillo(id) {
            capActual = id;
            const hoy = new Date().toDateString();
            
            if (typeof capacidadDB === 'undefined') {
                alert("Error: frases.js no cargado. Verifica el nombre del archivo.");
                return;
            }

            let p = JSON.parse(localStorage.getItem('pTigo')) || {agilidad:0, foco:0, colaboracion:0, integridad:0, talento:0, ultimosRetos: {}};
            const lista = capacidadDB[id];
            const randomItem = lista[Math.floor(Math.random() * lista.length)];

            document.getElementById('titulo-pasillo').innerText = id.toUpperCase();
            document.getElementById('frase-display').innerText = `"${randomItem.frase}"`;
            document.getElementById('reto-display').innerText = randomItem.reto;

            const yaHizoReto = p.ultimosRetos && p.ultimosRetos[id] === hoy;
            document.getElementById('btn-aceptar').style.display = yaHizoReto ? 'none' : 'block';
            document.getElementById('msg-bloqueo').style.display = yaHizoReto ? 'block' : 'none';

            document.getElementById('menu-principal').style.display = 'none';
            document.getElementById('pantalla-reto').style.display = 'flex';
        }

        function mostrarMenu() {
            document.getElementById('menu-principal').style.display = 'block';
            document.getElementById('pantalla-reto').style.display = 'none';
            actualizarInterfaz();
        }

        function completarReto() {
            const capacidad = capActual;
            const hoy = new Date().toDateString();
            
            let p = JSON.parse(localStorage.getItem('pTigo')) || {agilidad:0, foco:0, colaboracion:0, integridad:0, talento:0, ultimosRetos: {}};

            p[capacidad] = (p[capacidad] || 0) + 1;
            p.ultimosRetos[capacidad] = hoy;

            localStorage.setItem('pTigo', JSON.stringify(p));

            if (typeof confetti !== 'undefined') {
                confetti({
                    particleCount: 150,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#0033a0', '#ffcd00', '#ffffff']
                });
            }

            setTimeout(() => {
                alert(`¡Reto de ${capacidad.toUpperCase()} aceptado!\n\n"Diciendo y Haciendo".`);
                mostrarMenu();
            }, 500);
        }

        function actualizarInterfaz() {
            const hoy = new Date().toDateString();
            let p = JSON.parse(localStorage.getItem('pTigo')) || {agilidad:0, foco:0, colaboracion:0, integridad:0, talento:0, ultimosRetos: {}};
            
            const capacidades = ["agilidad", "foco", "colaboracion", "integridad", "talento"];

            capacidades.forEach(id => {
                const puntos = p[id] || 0;
                const perc = Math.min((puntos / 30) * 100, 100); 

                const barra = document.getElementById(`bar-${id}`);
                if (barra) barra.style.width = perc + '%';

                const ptsTxt = document.getElementById(`pts-${id}`);
                if (ptsTxt) ptsTxt.innerText = puntos;

                const yaHizoReto = p.ultimosRetos && p.ultimosRetos[id] === hoy;
                const card = document.getElementById(`card-${id}`);
                if (card) card.classList.toggle('completado-hoy', yaHizoReto);
                
                const badge = document.getElementById(`badge-${id}`);
                if (badge) badge.style.display = yaHizoReto ? 'block' : 'none';
            });
        }

        window.onload = checkAcceso;
    </script>
</body>
</html>
